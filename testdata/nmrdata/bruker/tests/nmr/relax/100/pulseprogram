# 1 "/opt/topspin3.2/exp/stan/nmr/lists/pp/user/cp3lev_satrec.aarz"
;cp (TopSpin 2.0)

;basic cp experiment
;written by HF 1.3.2001
;changed by JOS 05/06/03
;comments added by STE 4.4.2006

;Avance II+ version
;parameters: 
;p3 : proton 90 at power level pl2
;p15 : contact time at pl1 (f1) and pl2 (f2)
;pl1 : X power level during contact
;sp0 : proton power level during contact
;pl2 : 1H power for pulses
;pl12 : decoupling power level (if not pl13)
;pl13 : special decoupliong power level
;d1 : safety delay
;d20 : saturation delay (~3 ms)
;cnst21 : on resonance, usually = 0
;pcpd2 : pulse length in decoupling sequence
;cpdprg2 : cw, tppm (at pl12), or lgs, cwlg. cwlgs (LG-decoupling 
;spnam0 : use e.g. ramp.100 for variable amplitude CP
;here pl13 is used instead of pl12)
;zgoptns : -Dfslg, -Dlacq, or blank
# 26 "/opt/topspin3.2/exp/stan/nmr/lists/pp/user/cp3lev_satrec.aarz"
;$COMMENT=basic cp experiment, arbitrary contact and decoupling schemes
;$CLASS=Solids
;$DIM=1D
;$TYPE=cross polarisation
;$SUBTYPE=simple 1D
;$OWNER=belena
prosol relations=<solids_cp>

# 1 "/opt/topspin3.2/exp/stan/nmr/lists/pp/Avancesolids.incl" 1
;Avancesolids.incl
;   for TCU3
;
;version 1 28.2.2001, written by HF
;	   4.4.2006, complemented by Ste

;$CLASS=Solids INCL
;$COMMENT=definitions for setrtp and setnmr
# 10 "/opt/topspin3.2/exp/stan/nmr/lists/pp/Avancesolids.incl"
;switch between 1H or 19F output (H amplifier) 


# 14 "/opt/topspin3.2/exp/stan/nmr/lists/pp/Avancesolids.incl"
;gating pulse for RX, ADC and HPPR auto mode


# 18 "/opt/topspin3.2/exp/stan/nmr/lists/pp/Avancesolids.incl"
;explicit blanking of preamp, receiver, adc, not implemented yet


# 26 "/opt/topspin3.2/exp/stan/nmr/lists/pp/Avancesolids.incl"
;generate dwell clock


;turn dwell clock on/off
# 32 "/opt/topspin3.2/exp/stan/nmr/lists/pp/Avancesolids.incl"
;


# 36 "/opt/topspin3.2/exp/stan/nmr/lists/pp/Avancesolids.incl"
;define data sampling for WAHUHA type experiments, samples analogue or digitally for d9, closes receiver


# 40 "/opt/topspin3.2/exp/stan/nmr/lists/pp/Avancesolids.incl"
;explicit transmitter blanking, not supported yet

;NCO switching, to be implemented

;$id: $
# 34 "/opt/topspin3.2/exp/stan/nmr/lists/pp/user/cp3lev_satrec.aarz" 2
# 44 "/opt/topspin3.2/exp/stan/nmr/lists/pp/user/cp3lev_satrec.aarz"
;cnst11 : to adjust t=0 for acquisition, if digmod = baseopt
"acqt0=1u*cnst11"

# 1 "mc_line 47 file /opt/topspin3.2/exp/stan/nmr/lists/pp/user/cp3lev_satrec.aarz exp. def. part of mc cmd. before ze"
define delay MCWRK
define delay MCREST
"MCREST = d1 - 30m"
"MCWRK = 0.500000*30m"

    dccorr
# 47 "/opt/topspin3.2/exp/stan/nmr/lists/pp/user/cp3lev_satrec.aarz"
1 ze
# 1 "mc_line 47 file /opt/topspin3.2/exp/stan/nmr/lists/pp/user/cp3lev_satrec.aarz exp. def. of mc cmd. after ze"
# 48 "/opt/topspin3.2/exp/stan/nmr/lists/pp/user/cp3lev_satrec.aarz"
  30m
# 1 "mc_line 49 file /opt/topspin3.2/exp/stan/nmr/lists/pp/user/cp3lev_satrec.aarz exp. start label for mc cmd."
2 MCWRK  do:f2
LBLF1, MCWRK 
  MCREST
# 50 "/opt/topspin3.2/exp/stan/nmr/lists/pp/user/cp3lev_satrec.aarz"
# 1 "/opt/topspin3.2/exp/stan/nmr/lists/pp/user/p15_prot.incl" 1
;p15_prot.incl
;avance-version (13/01/29)
;Test the rf on-time and duty cycle
;protect against too long contact time
;Test the rf on-time and duty cycle 
;
;$CLASS=Solids INCL
;$COMMENT=protect against too long contact time

# 11 "/opt/topspin3.2/exp/stan/nmr/lists/pp/user/p15_prot.incl"
1m
if "p15 < 10.1m" goto Passp15
2u
print "contact time exceeds 10msec limit!"
goto HaltAcqu
Passp15, 1m


# 20 "/opt/topspin3.2/exp/stan/nmr/lists/pp/user/p15_prot.incl"
;$Id: p15_prot.incl,v 1.2.18.4 2013/01/29 15:40:51 ber Exp $
# 50 "/opt/topspin3.2/exp/stan/nmr/lists/pp/user/cp3lev_satrec.aarz" 2

			;make sure p15 does not exceed 10 msec	
			;let supervisor change this pulseprogram if 
			;more is needed

			;disable protection file for long acquisition change decoupling power !!! or you risk probe damage
			;if you set the label lacq (ZGOPTNS -Dlacq), the protection is disabled
# 58 "/opt/topspin3.2/exp/stan/nmr/lists/pp/user/cp3lev_satrec.aarz"
;#include <aq_prot.incl>	
			;allows max. 50 msec acquisition time, supervisor
			;may change  to max. 1s at less than 5 % duty cycle
			;and reduced decoupling field

3 d20 
  (p3 pl2 ph1):f2
  d20 
  (p3 pl2 ph11):f2
  lo to 3 times l20
  vd
  1u fq=cnst21:f2
  (p3 pl2 ph1):f2
  (p15 pl1 ph2):f1 (p15:sp0 ph10):f2
  1u cpds2:f2 		;pl12 is used here with tppm, pl13 with cwlg, cwlgs
  go=2 ph31
  1m do:f2
# 1 "mc_line 75 file /opt/topspin3.2/exp/stan/nmr/lists/pp/user/cp3lev_satrec.aarz exp. mc cmd. in line"
  MCWRK  wr #0 if #0 zd ivd 
  lo to LBLF1 times td1
  MCWRK
# 76 "/opt/topspin3.2/exp/stan/nmr/lists/pp/user/cp3lev_satrec.aarz"
HaltAcqu, 1m
exit

ph0= 0
ph1= 1 3
ph11= 3 1
ph2= 0 0 2 2 1 1 3 3
ph10= 0
ph31= 0 2 2 0 1 3 3 1
